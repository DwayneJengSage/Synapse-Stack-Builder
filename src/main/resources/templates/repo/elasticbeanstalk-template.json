{
	"AWSTemplateFormatVersion": "2010-09-09",
	"Resources": {
		"${environment.refName}Version": {
			"Type": "AWS::ElasticBeanstalk::ApplicationVersion",
			"Properties": {
				"ApplicationName": {
					"Fn::ImportValue": "${sharedExportPrefix}-Beanstalk-Application-Name"
				},
				"Description": "Artifact for ${environment.name}",
				"SourceBundle": {
					"S3Bucket": "${environment.sourceBundle.bucket}",
					"S3Key": "${environment.sourceBundle.key}"
				}
			}
		},
		"${environment.refName}Tempalte": {
			"Type": "AWS::ElasticBeanstalk::ConfigurationTemplate",
			"Properties": {
				"ApplicationName": {
					"Fn::ImportValue": "${sharedExportPrefix}-Beanstalk-Application-Name"
				},
				"Description": "ConfigurationTemplate for ${environment.name}",
				"SolutionStackName": "64bit Amazon Linux 2017.09 v2.7.7 running Tomcat 8 Java 8",
				"OptionSettings": [
					{
						"Namespace": "aws:autoscaling:launchconfiguration",
						"OptionName": "InstanceType",
						"Value": "m1.small"
					},
					{
						"Namespace": "aws:autoscaling:launchconfiguration",
						"OptionName": "ImageId",
						"Value": "ami-827b94f8"
					},
					{
						"Namespace": "aws:autoscaling:launchconfiguration",
						"OptionName": "EC2KeyName",
						"Value": "${stack}-key-pair"
					},
					{
						"Namespace": "aws:autoscaling:launchconfiguration",
						"OptionName": "IamInstanceProfile",
						"Value": "${stack}-s3-log-rolling"
					},
					{
						"Namespace": "aws:ec2:vpc",
						"OptionName": "VPCId",
						"Value": {
							"Fn::ImportValue": "${vpcExportPrefix}-VPCId"
						}
					},
					{
						"Namespace": "aws:ec2:vpc",
						"OptionName": "Subnets",
						"Value": {
							"Fn::ImportValue": "${vpcExportPrefix}-${subnetGroupColor}-Private-Subnets"
						}
					},
					{
						"Namespace": "aws:ec2:vpc",
						"OptionName": "ELBSubnets",
						"Value": {
							"Fn::ImportValue": "${vpcExportPrefix}-${subnetGroupColor}-Public-Subnets"
						}
					}
				]
			}
		},
		"${environment.refName}": {
			"Type": "AWS::ElasticBeanstalk::Environment",
			"Properties": {
				"ApplicationName": {
					"Fn::ImportValue": "${sharedExportPrefix}-Beanstalk-Application-Name"
				},
				"CNAMEPrefix": "${environment.name}-sagebase-org",
				"Description": "Environment for ${environment.name}",
				"EnvironmentName": "${environment.name}",
				"TemplateName": {
					"Ref": "${environment.refName}Tempalte"
				},
				"VersionLabel": {
					"Ref": "${environment.refName}Version"
				}
			}
		}
	}
}
