{
	"AWSTemplateFormatVersion": "2010-09-09",
	"Description": "Create a CNAME for a application.  Resulting name: <applicationPrefix>-<stack>-<instance>-<subInstance>.<stack>.sagebase.org",
	"Parameters": {
		"stack": {
			"Type": "String",
			"Description": "The stack prefix.  For example 'prod' or 'dev'",
			"AllowedValues": [
				"prod",
				"dev",
				"hud",
				"rel"
			]
		},
		"instance": {
			"Type": "Number",
			"Description": "The instance number of the stack."
		},
		"subInstance": {
			"Type": "Number",
			"Description": "Sub-instance number of the stack"
		},
		"applicationPrefix": {
			"Type": "String",
			"Description": "Which application this is for.",
			"AllowedValues": [
				"portal",
				"repo",
				"workers"
			]
		}
	},
	"Resources": {
		"ApplicationCNAME": {
			"Type": "AWS::Route53::RecordSet",
			"Properties": {
				"HostedZoneName": {
					"Fn::Sub": "${stack}.sagebase.org."
				},
				"Comment": "CNAME redirects to elastic beanstalk.",
				"Name": {
					"Fn::Sub": "${applicationPrefix}-${stack}-${instance}-${subInstance}.${stack}.sagebase.org."
				},
				"Type": "CNAME",
				"TTL": "300",
				"ResourceRecords": [
					{
						"Fn::Sub": "${applicationPrefix}-${stack}-${instance}-${subInstance}-${stack}.sagebase.org.us-east-1.elasticbeanstalk.com"
					}
				]
			}
		}
	},
	"Outputs": {
		"CNAME": {
			"Description": "Fully qualified domain name",
			"Value": {
				"Ref": "ApplicationCNAME"
			}
		}
	}
}
